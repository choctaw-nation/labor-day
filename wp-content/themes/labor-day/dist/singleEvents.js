(()=>{"use strict";const{postsPerPage:e,rootUrl:t}=cnoSiteData;const n=new class{getSchedule(){if(new Date>new Date("September 3, 2023"))return void localStorage.removeItem("schedule");const e=localStorage.getItem("schedule"),t=e?JSON.parse(e):null;if(null===t){return{friday:[],saturday:[],sunday:[]}}return t}addToSchedule(e){const{target:t}=e;return new Promise(((e,n)=>{try{this.checkTargetElement(t);const o=Number(t.dataset.id),s=this.getSchedule();if(!s)return;try{this.getEventData(o).then((t=>{const n=t.event_info.info.day.toLowerCase(),o=s[n].filter((e=>e.eventId===t.eventId));0===o?.length?(s[n].push(t),localStorage.setItem("schedule",JSON.stringify(s)),e("success")):o&&e("info")}))}catch(e){n(e)}}catch(e){console.error(e)}}))}checkTargetElement(e){if(!e)throw new Error("No target element provided");if("false"===e.dataset.addToSchedule)throw new Error("This button doesn't control scheduling!");if(void 0===e.dataset.id)throw new Error(`id or route is undefined! \n id: ${e.dataset.id} `)}getEventData=async e=>{try{const t=await fetch(`${cnoSiteData.rootUrl}/graphql?query=${encodeURIComponent(this.queryString(e))}`),n=await t.json(),{data:{events:{nodes:o}}}=n,s=function(e){const{eventLocations:{nodes:t}}=e,{eventTypes:{nodes:n}}=e,{eventId:o,link:s,title:r}=e,{event_info:c}=e,i={locations:t,type:n,eventId:o,link:s,title:r,event_info:c};return i.featuredImage=e.featuredImage?e.featuredImage.node:null,i}(o[0]);return s}catch(e){throw new Error(e)}};queryString(e){return`query Events {\n  events(where: {id: ${e}}) {\n    nodes {\n      eventId\n      title(format: RENDERED)\n      link\n      event_info {\n        info {\n          day\n          endTime\n          startTime\n        }\n        description\n      }\n      eventLocations {\n        nodes {\n          name\n          uri\n          event_locationId\n        }\n      }\n      eventTypes {\n        nodes {\n          name\n          uri\n          event_typeId\n        }\n      }\n      featuredImage {\n        node {\n          altText\n          mediaDetails {\n            sizes(include: [LARGE]) {\n              height\n              name\n              width\n              sourceUrl\n            }\n          }\n          srcSet(size: LARGE)\n\t\t  sizes(size: LARGE)\n        }\n      }\n    }\n  }\n}`}};var o={prefix:"fas",iconName:"pencil",icon:[512,512,[9999,61504,"pencil-alt"],"f303","M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"]};const s=new class{MESSAGE_TIMEOUT=4e3;constructor(){this.currentPage=location.href,this.buttons=document.querySelectorAll("[data-add-to-schedule]")}clickHandler(e){0!==this.buttons.length&&this.buttons.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();const n=this.buttons[0];n&&'<a href="/my-schedule"> View Schedule</a>'!==n.innerHTML&&(n.innerText="Loading...",e(t).then((e=>{n.innerHTML=this.getResponseMessage(e),setTimeout((()=>{n.innerHTML='<a href="/my-schedule"> View Schedule</a>'}),this.MESSAGE_TIMEOUT),this.showScheduleButton()})).catch((e=>{console.error(e)})))}),{once:!0})}))}getResponseMessage(e){let t="";return t="success"===e?"Added to your schedule!":"info"===e?"This event is already in your schedule.":"",t}showScheduleButton(){if(document.querySelector(".schedule-button")||location.href.includes("my-schedule"))return;const e=document.createElement("div");e.classList.add("schedule-button"),e.innerHTML=`<a href="/my-schedule"><svg viewBox="0 0 ${o.icon[0]} ${o.icon[0]}"><path d="${o.icon[4]}"></svg> View Your Schedule</a>`;document.querySelector("body").insertAdjacentElement("beforeend",e)}};new class{debug=!1;constructor(){const e=n.getSchedule();0<Object.values(e).flat().length&&s.showScheduleButton(),s.buttons.length>0&&s.clickHandler(n.addToSchedule.bind(n)),this.debug&&this.#e()}#e(){console.log("hello from schedule-handler"),console.log(s.buttons)}}})();