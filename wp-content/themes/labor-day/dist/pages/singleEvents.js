(()=>{"use strict";class e{getSchedule(){const e={friday:[],saturday:[],sunday:[]};if(new Date>new Date("September 1, 2024"))return localStorage.removeItem("schedule"),e;const t=localStorage.getItem("schedule"),s=t?JSON.parse(t):null;return null===s?e:s}addToSchedule(e){const t=e.target;return new Promise(((e,s)=>{try{this.checkTargetElement(t);const n=Number(t.dataset.id),o=this.getSchedule();if(!o)return;try{this.getEventData(n).then((t=>{const s=t.info.day.toLowerCase(),n=o[s].filter((e=>e.eventId===t.eventId));0===n?.length?(o[s].push(t),localStorage.setItem("schedule",JSON.stringify(o)),e("success")):n&&e("info")}))}catch(e){s(e)}}catch(e){throw e}}))}checkTargetElement(e){if(!e)throw new Error("No target element provided");if("false"===e.dataset.addToSchedule)throw new Error("This button doesn't control scheduling!");if(void 0===e.dataset.id)throw new Error(`id or route is undefined! \n id: ${e.dataset.id} `)}getEventData=async e=>{try{const t=await fetch(`${cnoSiteData.rootUrl}/wp-json/cno/v1/events?id=${e}`);if(!t.ok)throw new Error("There was an issue with the fetch request");return(await t.json())[0]}catch(e){throw e}}}var t=[512,512,[9999,61504,"pencil-alt"],"f303","M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"];class s{MESSAGE_TIMEOUT=4e3;constructor(){this.currentPage=window.location.href,this.buttons=document.querySelectorAll("[data-add-to-schedule]")}clickHandler(e){0!==this.buttons.length&&this.buttons.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();const s=this.buttons[0];s&&'<a href="/my-schedule"> View Schedule</a>'!==s.innerHTML&&(s.innerText="Loading...",e(t).then((e=>{s.innerHTML=this.getResponseMessage(e),setTimeout((()=>{s.innerHTML='<a href="/my-schedule"> View Schedule</a>'}),this.MESSAGE_TIMEOUT),this.showScheduleButton()})).catch((e=>{console.error(e)})))}),{once:!0})}))}getResponseMessage(e){let t="";return t="success"===e?"Added to your schedule!":"info"===e?"This event is already in your schedule.":"",t}showScheduleButton(){if(document.querySelector(".schedule-button")||window.location.href.includes("my-schedule"))return;const e=document.createElement("div");e.classList.add("schedule-button"),e.innerHTML=`<a href="/my-schedule"><svg viewBox="0 0 ${t[0]} ${t[0]}"><path d="${t[4]}"></svg> View Your Schedule</a>`,document.querySelector("body").insertAdjacentElement("beforeend",e)}}new class{debug=!0;constructor(){this.view=new s;const t=new e,n=t.getSchedule();0<Object.values(n).flat().length&&this.view.showScheduleButton(),this.view.buttons.length>0&&this.view.clickHandler(t.addToSchedule.bind(t)),this.debug&&this.debugMethod()}debugMethod(){console.log("hello from schedule-handler"),console.log(this.view.buttons)}}})();